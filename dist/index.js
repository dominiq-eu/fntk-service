parcelRequire=function(e,r,n,t){var i="function"==typeof parcelRequire&&parcelRequire,o="function"==typeof require&&require;function u(n,t){if(!r[n]){if(!e[n]){var f="function"==typeof parcelRequire&&parcelRequire;if(!t&&f)return f(n,!0);if(i)return i(n,!0);if(o&&"string"==typeof n)return o(n);var c=new Error("Cannot find module '"+n+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[n][1][r]||r};var l=r[n]=new u.Module(n);e[n][0].call(l.exports,p,l,l.exports,this)}return r[n].exports;function p(e){return u(p.resolve(e))}}u.isParcelRequire=!0,u.Module=function(e){this.id=e,this.bundle=u,this.exports={}},u.modules=e,u.cache=r,u.parent=i,u.register=function(r,n){e[r]=[function(e,r){r.exports=n},{}]};for(var f=0;f<n.length;f++)u(n[f]);if(n.length){var c=u(n[n.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=c:"function"==typeof define&&define.amd?define(function(){return c}):t&&(this[t]=c)}return u}({"2SjF":[function(require,module,exports) {
const{Let:e}=require("@fntk/utils"),t=(a=(e=>e),c=[],n=[])=>({add:e=>t(a,c.concat([e]),n),use:e=>t(a,c,n.concat([e])),do:e=>t(e,c,n),start:()=>e({dataPipeline:n.concat(a).reduce((e,t)=>a=>t(e(a)),e=>e)}).In(({dataPipeline:e})=>c.forEach(t=>t(e)))});module.exports=t;
},{}],"9ee7":[function(require,module,exports) {
const{Data:e,StringType:t}=require("@fntk/types"),a=e("Request",{path:String,payload:Object});a.NLP=a.derive(e=>({path:"/",payload:{sentence:t(e)}})),module.exports=a;
},{}],"csfc":[function(require,module,exports) {
const{Union:e,Result:r}=require("@fntk/types"),{Random:n}=require("@fntk/utils"),o=r.Ok.derive(e=>random(e)),s=e("Response",{Success:r.Ok,Error:r.Err,Random:o});module.exports=s;
},{}],"shZs":[function(require,module,exports) {
const e=require("express"),r=require("compression"),t=require("body-parser"),s=require("url"),n=require("http"),{Data:u}=require("@fntk/types"),{Log:o}=require("@fntk/utils"),d=o("WebService"),i=u("HTTPHeader",{method:String,url:String,path:String,headers:Object}),a=u("HTTPRequest",{http:i,data:Object}),h=e=>null!==e&&"object"==typeof e,l=e=>e.then?e:Promise.resolve(e),p=e=>h(e)?JSON.stringify(e,0,4):e,c=e=>Boolean(Object.keys(e).length),b=n=>e().use(r()).use(t.json()).use(t.urlencoded({extended:!0})).all("*",(e,r,t)=>{const u=s.parse(e.url,!0);d.debug("URL",u);const o=a({http:i({method:e.method,headers:e.headers,url:e.url,path:u.pathname}),data:c(u.query)?u.query:e.body});d.debug("Request",o);return(e=>l(n(e)))(o).then(p).then(e=>(d.debug("[WebService] Response: ",e),r.write(e),r.end()))}),g=e=>{const r=b(e);return n.createServer(r).listen(8e3,()=>d.debug("Listening on: 0.0.0.0:8000"))};module.exports={program:g};
},{}],"9Fxe":[function(require,module,exports) {
const e=require("./web-service"),t=require("../../data/request"),{Log:r}=require("@fntk/utils"),a=r("HTTPGateway");module.exports=(r=>r=>e.program(e=>{a.debug("HTTPRequest",e);const u=t({path:e.http.path,payload:e.data});return a.debug("Request",u),r(u)}));
},{"./web-service":"shZs","../../data/request":"9ee7"}],"8f4u":[function(require,module,exports) {
const e=require("../../data/request"),r=require("telebot"),{Union:t,StringType:s}=require("@fntk/types"),{Log:o}=require("@fntk/utils"),n=o("TelegramGateway"),a=e=>e.then?e:Promise.resolve(e),d=t("TelegramParseMode",{Text:s.of("Text"),Markdown:s.of("Markdown"),HTML:s.of("HTML")}),u=function({token:t,parseMode:s=d.Text()}){return n.debug("parseMode",s),d.check(s),n.debug("ParseMode",s),o=>{const d=new r({token:t,polling:{interval:1e3}});return d.on("text",r=>{n.debug("Request",r);return(e=>a(o(e)))(e.NLP(r.text)).then(e=>{n.debug("Response",e);const t=String(e.value);return n.debug("Answer",t),d.sendMessage(r.from.id,t,{parseMode:s,replyToMessage:r.message_id})}).catch(e=>(n.debug("Error",e),d.sendMessage(r.from.id,"Internal Error",{replyToMessage:r.message_id})))}),d.start()}};u.ParseMode=d,module.exports=u;
},{"../../data/request":"9ee7"}],"T0sK":[function(require,module,exports) {
const e=require("snowball"),t=require("natural"),n=require("nlp-toolkit"),r=require("stopwords-iso"),s=require("fs"),a=require("../data/request"),i=require("../data/response"),{Log:o}=require("@fntk/utils"),u=o("NLPMiddleware"),c={de:"German",en:"English"},l={lang:"de",functions:[]},p=e=>s.readdirSync(e).map(t=>`${e}/${t}`).filter(e=>s.statSync(e).isDirectory()).reduce((e,t)=>e.concat(t).concat(p(t)),[]),d=e=>p(e).reduce((t,n)=>{try{const r=require(`${n}/function.json`);if(r.sentences.de||r.sentences.en)return t.concat([{path:n.replace(e,""),sentences:r.sentences}])}catch(e){}return t},[]),g=(e,t)=>e.split(" ").filter(e=>!r[t].includes(e)).join(" ").trim(),f=t=>{if(t.length>5){const n=new e(c[l.lang]),r=g(t.toLowerCase().trim(),l.lang);return n.setCurrent(r),n.stem(),n.getCurrent()}return t.toLowerCase()},h=e=>{const t=n.tokenizer(e),r=n.stemmer(t,{lang:l.lang});return g(r.join(" ").trim(),l.lang)},m=(e,n,r)=>{const s=e(r.toLowerCase().trim()),a=e(n.toLowerCase().trim());return[t.JaroWinklerDistance(s,a),s]},b=(e,t,n)=>n.map(n=>m(e,t,n)).sort(([e,t],[n,r])=>n-e).filter(([e,t])=>e>=.75).map(([e,t])=>({value:e,txt:t})),q=(e,t)=>{const n=b(f,e,t.sentences.de)[0];return void 0!==(n&&n.value)?n.value:0},y=e=>t=>e.reduce((e,n)=>e.concat([{propability:q(t,n),sentences:n.sentences,path:n.path}]),[]).filter(e=>e.propability>0).sort((e,t)=>t.propability-e.propability);module.exports=(({path:e})=>{u.debug("Path",e),l.functions=d(e),u.debug("GetNlpFunctions",l.functions);const t=y(l.functions);return u.debug("getMatch",t),e=>{if(u.debug("request",e),a.NLP.is(e)){const n=e.payload.sentence,r=t(n);if(u.debug("MatchTable",r),r.length>0){const e=r[0].path,t=a({path:e,payload:{sentence:n}});return u.debug("NewRequest",t),t}}return e}});
},{"../data/request":"9ee7","../data/response":"csfc"}],"Focm":[function(require,module,exports) {
const e=require("./data/app"),r=require("./data/request"),t=require("./data/response"),a=require("./gateways/http"),o=require("./gateways/telegram"),u=require("./middleware/nlp"),s=require("path"),n=s.resolve(process.cwd())+"/functions",i=3e3,p=(e,r)=>{return require(r)(e.payload)},d=({path:e})=>a=>{if(r.is(a)){const r=`${e}${a.path}`;try{return console.log("[Router] Path:",r),console.log("[Router] Request:",a),p(a,r)}catch(e){return console.log("Load Function: Error: ",e),t.Error("Can't find "+r)}}return t.Error("Invalid request: "+a)},l=e().add(a({port:3e3})).use(u({path:n})).do(d({path:n}));module.exports={Service:l,App:e,Router:d,Request:r,Response:t,HTTPGateway:a,TelegramGateway:o,NLPMiddleware:u};
},{"./data/app":"2SjF","./data/request":"9ee7","./data/response":"csfc","./gateways/http":"9Fxe","./gateways/telegram":"8f4u","./middleware/nlp":"T0sK"}]},{},["Focm"], null)
//# sourceMappingURL=/index.map