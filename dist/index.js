parcelRequire=function(e,r,n,t){var i="function"==typeof parcelRequire&&parcelRequire,o="function"==typeof require&&require;function u(n,t){if(!r[n]){if(!e[n]){var f="function"==typeof parcelRequire&&parcelRequire;if(!t&&f)return f(n,!0);if(i)return i(n,!0);if(o&&"string"==typeof n)return o(n);var c=new Error("Cannot find module '"+n+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[n][1][r]||r};var l=r[n]=new u.Module(n);e[n][0].call(l.exports,p,l,l.exports,this)}return r[n].exports;function p(e){return u(p.resolve(e))}}u.isParcelRequire=!0,u.Module=function(e){this.id=e,this.bundle=u,this.exports={}},u.modules=e,u.cache=r,u.parent=i,u.register=function(r,n){e[r]=[function(e,r){r.exports=n},{}]};for(var f=0;f<n.length;f++)u(n[f]);if(n.length){var c=u(n[n.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=c:"function"==typeof define&&define.amd?define(function(){return c}):t&&(this[t]=c)}return u}({"jWsf":[function(require,module,exports) {
const e=(e,n)=>Math.floor(Math.random()*(n-e+1))+e,n=(n=[])=>{if(n.length>0){return n[e(0,n.length-1)]}return e(0,100)},t=e=>({andThen:n=>e.then?t(e.then(n)):t(n(e)),value:()=>e}),r=e=>({In:n=>n(e)});module.exports={Pipe:t,Let:r,random:n,randomBetween:e};
},{}],"2SjF":[function(require,module,exports) {
const{Let:e}=require("../utils"),t=(a=(e=>e),c=[],o=[])=>({add:e=>t(a,c.concat([e]),o),use:e=>t(a,c,o.concat([e])),do:e=>t(e,c,o),start:()=>e({dataPipeline:o.concat(a).reduce((e,t)=>a=>t(e(a)),e=>e)}).In(({dataPipeline:e})=>c.forEach(t=>t(e)))});module.exports=t;
},{"../utils":"jWsf"}],"9ee7":[function(require,module,exports) {
const{Data:e,StringType:t}=require("@fntk/types"),a=e("Request",{path:String,payload:Object});a.NLP=a.derive(e=>({path:"/",payload:{sentence:t(e)}})),module.exports=a;
},{}],"csfc":[function(require,module,exports) {
const{Type:e,Union:r,Result:s}=require("@fntk/types"),{random:o}=require("../utils"),n=s.Ok.derive(e=>o(e)),t=r("Response",{Success:s.Ok,Error:s.Err,Random:n});module.exports=t;
},{"../utils":"jWsf"}],"shZs":[function(require,module,exports) {
const e=require("express"),r=require("compression"),t=require("body-parser"),o=require("url"),s=require("http"),{Data:n}=require("@fntk/types"),l=n("HTTPHeader",{method:String,url:String,path:String,headers:Object}),u=n("HTTPRequest",{http:l,data:Object}),a=e=>null!==e&&"object"==typeof e,i=e=>e.then?e:Promise.resolve(e),d=e=>a(e)?JSON.stringify(e,0,4):e,c=e=>Boolean(Object.keys(e).length),h=s=>e().use(r()).use(t.json()).use(t.urlencoded({extended:!0})).all("*",(e,r,t)=>{const n=o.parse(e.url,!0);console.log("URL:",n);const a=u({http:l({method:e.method,headers:e.headers,url:e.url,path:n.pathname}),data:c(n.query)?n.query:e.body});console.log("Request:",a);return(e=>i(s(e)))(a).then(d).then(e=>(console.log("[WebService] Response: ",e),r.write(e),r.end()))}),p=e=>{const r=h(e);return s.createServer(r).listen(8e3,()=>console.log("Listening on port: 8000"))};module.exports={program:p};
},{}],"9Fxe":[function(require,module,exports) {
const e=require("./web-service"),t=require("../../data/request");module.exports=(o=>o=>e.program(e=>{console.log("Http:",e);const r=t({path:e.http.path,payload:e.data});return console.log("Request:",r),o(r)}));
},{"./web-service":"shZs","../../data/request":"9ee7"}],"8f4u":[function(require,module,exports) {
const e=require("../../data/request"),o=require("telebot"),{Union:r,StringType:a}=require("@fntk/types"),t=e=>e.then?e:Promise.resolve(e),s=r("TelegramParseMode",{Text:a.of("Text"),Markdown:a.of("Markdown"),HTML:a.of("HTML")}),n=function({token:r,parseMode:a=s.Text()}){return console.log("[Gateway] [Telegram] parseMode:",a),s.check(a),console.log("[Gateway] [Telegram] ParseMode:",a),s=>{const n=new o({token:r,polling:{interval:1e3}});return n.on("text",o=>{console.log("[Gateway] [Telegram] Request: ",o);return(e=>t(s(e)))(e.NLP(o.text)).then(e=>{console.log("[Gateway] [Telegram] Response: ",e);const r=String(e.value);return console.log("[Gateway] [Telegram] Answer: ",r),n.sendMessage(o.from.id,r,{parseMode:a,replyToMessage:o.message_id})}).catch(e=>(console.log("[Gateway] [Telegram] Error:",e),n.sendMessage(o.from.id,"Internal Error",{replyToMessage:o.message_id})))}),n.start()}};n.ParseMode=s,module.exports=n;
},{"../../data/request":"9ee7"}],"T0sK":[function(require,module,exports) {
const e=require("snowball"),t=require("natural"),n=require("nlp-toolkit"),r=require("stopwords-iso"),o=require("fs"),s=require("../data/request"),a=require("../data/response"),c={de:"German",en:"English"},i={lang:"de",functions:[]},l=e=>t=>(console.log(e,t),t),u=e=>o.readdirSync(e).map(t=>`${e}/${t}`).filter(e=>o.statSync(e).isDirectory()).reduce((e,t)=>e.concat(t).concat(u(t)),[]),p=e=>u(e).reduce((t,n)=>{try{const r=require(`${n}/function.json`);(r.sentences.de||r.sentences.en)&&(t=t.concat([{path:n.replace(e,""),sentences:r.sentences}]))}catch(e){}return t},[]),d=(e,t)=>e.split(" ").filter(e=>!r[t].includes(e)).join(" ").trim(),g=t=>{if(t.length>5){const n=new e(c[i.lang]),r=d(t.toLowerCase().trim(),i.lang);return n.setCurrent(r),n.stem(),n.getCurrent()}return t.toLowerCase()},f=e=>{const t=n.tokenizer(e),r=n.stemmer(t,{lang:i.lang});return d(r.join(" ").trim(),i.lang)},h=(e,n,r)=>{const o=e(r.toLowerCase().trim()),s=e(n.toLowerCase().trim());return[t.JaroWinklerDistance(o,s),o]},m=(e,t,n)=>n.map(n=>h(e,t,n)).sort(([e,t],[n,r])=>n-e).filter(([e,t])=>e>=.75).map(([e,t])=>({value:e,txt:t})),q=(e,t)=>{const n=m(g,e,t.sentences.de)[0];return void 0!==(n&&n.value)?n.value:0},w=e=>t=>e.reduce((e,n)=>e.concat([{propability:q(t,n),sentences:n.sentences,path:n.path}]),[]).filter(e=>e.propability>0).sort((e,t)=>t.propability-e.propability);module.exports=(({path:e})=>{console.log("[Middleware] [NLP] Path:",e),i.functions=p(e),console.log("GetNlpFunctions:",i.functions);const t=w(i.functions);return console.log("getMatch:",t),e=>{if(console.log("[Middleware] [NLP] request:",e),s.NLP.is(e)){const n=e.payload.sentence,r=t(n);if(console.log("MatchTable:",r),r.length>0){const e=r[0].path,t=s({path:e,payload:{sentence:n}});return console.log("[Middleware] [NLP] Generated Request:",t),t}}return e}});
},{"../data/request":"9ee7","../data/response":"csfc"}],"Focm":[function(require,module,exports) {
const e=require("./data/app"),r=require("./data/request"),t=require("./data/response"),a=require("./gateways/http"),o=require("./gateways/telegram"),u=require("./middleware/nlp"),s=require("path"),n=s.resolve(process.cwd())+"/functions",i=3e3,p=(e,r)=>{return require(r)(e.payload)},d=({path:e})=>a=>{if(r.is(a)){const r=`${e}${a.path}`;try{return console.log("[Router] Path:",r),console.log("[Router] Request:",a),p(a,r)}catch(e){return console.log("Load Function: Error: ",e),t.Error("Can't find "+r)}}return t.Error("Invalid request: "+a)},l=e().add(a({port:3e3})).use(u({path:n})).do(d({path:n}));module.exports={Service:l,App:e,Router:d,Request:r,Response:t,HTTPGateway:a,TelegramGateway:o,NLPMiddleware:u};
},{"./data/app":"2SjF","./data/request":"9ee7","./data/response":"csfc","./gateways/http":"9Fxe","./gateways/telegram":"8f4u","./middleware/nlp":"T0sK"}]},{},["Focm"], null)
//# sourceMappingURL=/index.map